<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E15T075SB3"></script>
    <script data-cfasync="false">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-E15T075SB3');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-root" content="/book-aspnet-htmx">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.11.0.822097508951">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.11.0">

    <!-- Primary Meta Tags -->
    <title>Caching and History with hx-history and hx-history-elt</title>
    <meta name="title" content="Caching and History with hx-history and hx-history-elt">
    <meta name="description" content="The fastest request is the one you never make. If you have ever hit the back button on a web app and watched it reload a page you visited seconds...">

    <!-- Canonical -->
    <link rel="canonical" href="https://cwoodruff.github.io/book-aspnet-htmx/chapter18/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cwoodruff.github.io/book-aspnet-htmx/chapter18/">
    <meta property="og:title" content="Caching and History with hx-history and hx-history-elt">
    <meta property="og:description" content="The fastest request is the one you never make. If you have ever hit the back button on a web app and watched it reload a page you visited seconds...">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://cwoodruff.github.io/book-aspnet-htmx/chapter18/">
    <meta property="twitter:title" content="Caching and History with hx-history and hx-history-elt">
    <meta property="twitter:description" content="The fastest request is the one you never make. If you have ever hit the back button on a web app and watched it reload a page you visited seconds...">

    <script data-cfasync="false">(function(){var cl=document.documentElement.classList,ls=localStorage.getItem("retype_scheme"),hd=cl.contains("dark"),hl=cl.contains("light"),wm=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;if(ls==="dark"||(!ls&&wm&&!hd&&!hl)){cl.remove("light");cl.add("dark")}else if(ls==="light"||(!ls&&!wm&&!hd&&!hl)){cl.remove("dark");cl.add("light")}})();</script>

    <link href="../images/favicon.png" rel="icon">
    <link href="../resources/css/retype.css?v=3.11.0.822097508951" rel="stylesheet">

    <script data-cfasync="false" src="../resources/js/config.js?v=3.11.0.822097508951" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../resources/js/retype.js?v=3.11.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../resources/js/lunr.js?v=3.11.0.822097508951" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../resources/js/prism.js?v=3.11.0.822097508951" defer></script>
</head>
<body>
    <div id="retype-app" class="relative text-base antialiased text-base-text bg-base-bg font-body">
        <div class="absolute bottom-0 left-0" style="top: 5rem; right: 50%"></div>
    
        <header id="retype-header" class="sticky top-0 z-30 flex w-full h-16 bg-header-bg border-b border-header-border md:h-20">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton retype-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="retype-sidebar-left-toggle-button"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="retype-branding-logo" href="../" class="flex items-center leading-snug text-xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../images/network200.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../images/network200.png">
                            </span>
                            <span class="dark:text-white font-bold line-clamp-1 md:line-clamp-2">ASP.NET Core Reimagined with htmx</span>
                        </a><span id="retype-branding-label" class="inline-flex mt-1 px-2 py-1 ml-4 text-xs font-medium leading-none items-center rounded-md bg-branding-label-bg text-branding-label-text ring-1 ring-branding-label-border ring-inset md:inline-block">v1</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block border-base-border"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav id="retype-header-nav" class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="../">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                        </g>
                                    </svg>
                                    <span>Home</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/cwoodruff/book-aspnet-htmx/issues" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"/><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"/>
                                        </g>
                                    </svg>
                                    <span>Issues</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://bsky.app/profile/woodruff.dev" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M18.231,3.618c-2.312,1.736-4.785,5.107-5.948,7.244c-0.123,0.226-0.444,0.226-0.567,0	c-1.163-2.137-3.636-5.508-5.948-7.244C3.949,2.252,1,1.195,1,4.559c0,0.672,0.385,5.643,0.611,6.451	c0.606,2.169,2.454,3.089,4.437,3.195c0.19,0.01,0.222,0.261,0.043,0.324c-2.988,1.048-3.518,3.196-1.424,5.344	c3.826,3.894,5.814,0.647,6.733-1.514c0.224-0.525,0.977-0.525,1.2,0c0.92,2.161,2.907,5.408,6.733,1.514	c2.093-2.148,1.564-4.296-1.424-5.344c-0.179-0.063-0.146-0.313,0.043-0.324c1.983-0.106,3.83-1.026,4.437-3.195	C22.615,10.203,23,5.231,23,4.559C23,1.195,20.051,2.252,18.231,3.618z"></path>
                                        </g>
                                    </svg>
                                    <span>Bluesky</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://mastodon.social/@cwoodruff" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a4 4 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522q0-1.288.66-2.046c.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764q.662.757.661 2.046z"/>
                                        </g>
                                    </svg>
                                    <span>Mastodon</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-search-placeholder transition-colors duration-200 ease-in bg-search-bg border border-transparent rounded md:text-sm hover:border-search-border-hover focus:outline-none focus:border-search-border-focus" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="retype-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
    
        <div id="retype-container" class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-sidebar-left-bg border-sidebar-left-border sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton">
            
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-filter-bg border border-filter-border rounded shadow-none text-sm focus:outline-none focus:border-filter-border-focus" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-base-border">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-base-border">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-base-border">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="../">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                                </g>
                                            </svg>
                                            <span>Home</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/cwoodruff/book-aspnet-htmx/issues" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"/><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"/>
                                                </g>
                                            </svg>
                                            <span>Issues</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://bsky.app/profile/woodruff.dev" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M18.231,3.618c-2.312,1.736-4.785,5.107-5.948,7.244c-0.123,0.226-0.444,0.226-0.567,0	c-1.163-2.137-3.636-5.508-5.948-7.244C3.949,2.252,1,1.195,1,4.559c0,0.672,0.385,5.643,0.611,6.451	c0.606,2.169,2.454,3.089,4.437,3.195c0.19,0.01,0.222,0.261,0.043,0.324c-2.988,1.048-3.518,3.196-1.424,5.344	c3.826,3.894,5.814,0.647,6.733-1.514c0.224-0.525,0.977-0.525,1.2,0c0.92,2.161,2.907,5.408,6.733,1.514	c2.093-2.148,1.564-4.296-1.424-5.344c-0.179-0.063-0.146-0.313,0.043-0.324c1.983-0.106,3.83-1.026,4.437-3.195	C22.615,10.203,23,5.231,23,4.559C23,1.195,20.051,2.252,18.231,3.618z"></path>
                                                </g>
                                            </svg>
                                            <span>Bluesky</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://mastodon.social/@cwoodruff" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a4 4 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522q0-1.288.66-2.046c.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764q.662.757.661 2.046z"/>
                                                </g>
                                            </svg>
                                            <span>Mastodon</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 bg-body-bg">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div id="retype-main" class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="retype-markdown" id="retype-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="retype-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="caching-and-history-with-hx-history-and-hx-history-elt" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#caching-and-history-with-hx-history-and-hx-history-elt">#</doc-anchor-trigger>
        <span>Caching and History with <code v-pre>hx-history</code> and <code v-pre>hx-history-elt</code></span>
    </h1>
</doc-anchor-target>
<p>The fastest request is the one you never make. If you have ever hit the back button on a web app and watched it reload a page you visited seconds ago, you know the frustration. That reload breaks your flow, wastes your time, and makes the app feel sluggish. This chapter shows you how htmx eliminates that pain by caching responses in the browser&#x27;s history stack. With minimal effort, your Razor Pages can feel as fluid as a single-page app without the JavaScript complexity.</p>
<p>You have already seen how htmx handles form submissions, dynamic interactions, and server-driven updates. Now you can give users a smoother navigation experience by preserving state across page transitions. These features do more than improve performance. They let users move backward and forward through your app without losing their place or waiting for redundant server calls. This builds naturally on the scoped updates, real-time interactions, and Hyperscript techniques from earlier chapters.</p>
<p>We will start by examining how htmx manages browser history and caching. You will learn how to control caching behavior for specific elements, reducing server load while making your app feel more responsive. A content-heavy dashboard benefits from caching just as much as a multi-step workflow does. In both cases, intelligent caching dramatically improves the user experience.</p>
<p>By the end of this chapter, you will have the tools to create state-aware applications that feel fast and modern while keeping the simplicity of Razor Pages. Let us see how htmx puts the browser&#x27;s built-in navigation features to work for you.</p>
<doc-anchor-target id="understanding-htmx-history-caching">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#understanding-htmx-history-caching">#</doc-anchor-trigger>
        <span>Understanding htmx History Caching</span>
    </h2>
</doc-anchor-target>
<p>Before we look at specific attributes and code, you need to understand how htmx handles history. When you use <code v-pre>hx-push-url=&quot;true&quot;</code> on a request, htmx automatically does two things: it updates the browser&#x27;s URL, and it saves a snapshot of the current page content to a local cache. This cache lives in the browser&#x27;s <code v-pre>localStorage</code> and holds the HTML content that was on the page before the navigation occurred.</p>
<p>When a user clicks the back button, htmx intercepts that navigation. Instead of making a new server request, it pulls the cached HTML from <code v-pre>localStorage</code> and restores it to the page. This restoration happens almost instantly because no network round-trip is required.</p>
<p>The key insight here is that htmx caches by default when you push URLs. The <code v-pre>hx-history</code> attribute exists primarily to opt out of this behavior, not to opt in. Setting <code v-pre>hx-history=&quot;false&quot;</code> tells htmx to skip caching for that particular element or request. This becomes important when you have sensitive content like personal information, checkout flows, or admin panels that should not persist in the browser&#x27;s cache.</p>
<p>You can control how many pages htmx keeps in its history cache through configuration:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-javascript"><code v-pre class="language-javascript">htmx.config.historyCacheSize = 10; // Default is 10 pages</code></pre>
</doc-codeblock></div>
<p>Setting this to zero disables history caching entirely. For most applications, the default works well, but you might increase it for apps where users frequently navigate back through many pages.</p>
<doc-anchor-target id="making-back-feel-fast-again-history-management-with-hx-history">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#making-back-feel-fast-again-history-management-with-hx-history">#</doc-anchor-trigger>
        <span>Making Back Feel Fast Again: History Management with <code v-pre>hx-history</code></span>
    </h2>
</doc-anchor-target>
<p>In traditional server-rendered apps, clicking the back button typically reloads the entire page. Users lose form inputs, search results disappear, and any scroll position resets. This behavior is so common that many users avoid the back button altogether. With htmx, you can reclaim the back button and make it work the way users expect.</p>
<p>When <code v-pre>hx-push-url=&quot;true&quot;</code> is set on a request, htmx stores the current page content before swapping in the new response. If the user navigates back, htmx restores that stored content without hitting the server. The result feels instant.</p>
<p>Consider a user searching for products in your app. They browse results, click into a product detail page, then hit the back button expecting to see their search results. Without htmx history caching, the page reloads and the results vanish. With <code v-pre>hx-push-url=&quot;true&quot;</code>, the result list reappears immediately, exactly as they left it. No server call. No loading spinner. No frustration.</p>
<p>Here is a search form on a <code v-pre>Search.cshtml</code> page that demonstrates this pattern:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;form hx-get=&quot;/Search?handler=Results&quot;
      hx-target=&quot;#search-results&quot;
      hx-push-url=&quot;true&quot;
      hx-swap=&quot;innerHTML&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;query&quot; placeholder=&quot;Search products...&quot; /&gt;
    &lt;button type=&quot;submit&quot;&gt;Search&lt;/button&gt;
&lt;/form&gt;

&lt;div id=&quot;search-results&quot;&gt;&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>The <code v-pre>hx-push-url=&quot;true&quot;</code> attribute handles the caching work. It updates the browser URL with the search query and triggers htmx to cache the page state. When the user navigates away and returns, htmx restores the cached results.</p>
<p>On the server side, the handler returns a partial view:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-csharp"><code v-pre class="language-csharp">public class SearchModel : PageModel
{
    private readonly IProductRepository _productRepository;

    public SearchModel(IProductRepository productRepository)
    {
        _productRepository = productRepository;
    }

    public IActionResult OnGetResults(string query)
    {
        var products = _productRepository.Search(query);
        return Partial(&quot;_SearchResults&quot;, products);
    }
}</code></pre>
</doc-codeblock></div>
<p>The <code v-pre>_SearchResults.cshtml</code> partial renders the product list:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">@model IEnumerable&lt;Product&gt;

&lt;ul&gt;
    @foreach (var product in Model)
    {
        &lt;li&gt;
            &lt;a href=&quot;/Products/Details?id=@product.Id&quot;
               hx-get=&quot;/Products/Details?id=@product.Id&quot;
               hx-target=&quot;#main-content&quot;
               hx-push-url=&quot;true&quot;&gt;
                @product.Name
            &lt;/a&gt;
        &lt;/li&gt;
    }
&lt;/ul&gt;</code></pre>
</doc-codeblock></div>
<p>Notice that the product links use <code v-pre>hx-target=&quot;#main-content&quot;</code> rather than targeting the body. This scoped approach gives you more control over what gets replaced and avoids potential issues with scripts or styles in the document head.</p>
<p>When should you disable history caching? Use <code v-pre>hx-history=&quot;false&quot;</code> in these situations:</p>
<ul>
<li>Checkout or payment pages where sensitive data should not persist</li>
<li>User profile or account settings pages</li>
<li>Admin panels with privileged information</li>
<li>Any content that becomes stale quickly and must be fresh on every view</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div hx-get=&quot;/Checkout?handler=Summary&quot;
     hx-target=&quot;#checkout-content&quot;
     hx-push-url=&quot;true&quot;
     hx-history=&quot;false&quot;&gt;
    &lt;!-- Checkout content should never be cached --&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>This pattern keeps secure content out of the browser&#x27;s localStorage while still updating the URL for bookmarking purposes.</p>
<doc-anchor-target id="locking-in-the-experience-retaining-state-with-hx-history-elt">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#locking-in-the-experience-retaining-state-with-hx-history-elt">#</doc-anchor-trigger>
        <span>Locking In the Experience: Retaining State with <code v-pre>hx-history-elt</code></span>
    </h2>
</doc-anchor-target>
<p>The <code v-pre>hx-history-elt</code> attribute solves a specific problem: which element&#x27;s innerHTML should htmx snapshot when saving to the history cache? By default, htmx snapshots the body element. This works for simple pages, but complex layouts often need more precision.</p>
<p>Place <code v-pre>hx-history-elt</code> on the container element whose content represents the &quot;main&quot; state of your page. When htmx takes a history snapshot, it captures the innerHTML of this element. When the user navigates back, htmx restores that specific content.</p>
<p>Consider a dashboard with a main content area and persistent navigation:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;body&gt;
    &lt;nav id=&quot;sidebar&quot;&gt;
        &lt;!-- Navigation stays constant --&gt;
    &lt;/nav&gt;
    
    &lt;main id=&quot;app-content&quot; hx-history-elt&gt;
        &lt;!-- This content gets cached and restored --&gt;
    &lt;/main&gt;
    
    &lt;aside id=&quot;notifications&quot;&gt;
        &lt;!-- Live content that should not be cached --&gt;
    &lt;/aside&gt;
&lt;/body&gt;</code></pre>
</doc-codeblock></div>
<p>With <code v-pre>hx-history-elt</code> on <code v-pre>#app-content</code>, htmx only caches the main content area. The sidebar stays untouched, and the notifications panel can update independently without being overwritten by stale cached data.</p>
<p>Here is a tabbed interface that uses this pattern:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div id=&quot;dashboard-content&quot; hx-history-elt&gt;
    &lt;div class=&quot;tab-buttons&quot;&gt;
        &lt;button class=&quot;tab-button active&quot;
                hx-get=&quot;/Dashboard?handler=Tab1&quot;
                hx-target=&quot;#tab-content&quot;
                hx-push-url=&quot;true&quot;
                _=&quot;on click remove .active from .tab-button then add .active to me&quot;&gt;
            Tab 1
        &lt;/button&gt;
        &lt;button class=&quot;tab-button&quot;
                hx-get=&quot;/Dashboard?handler=Tab2&quot;
                hx-target=&quot;#tab-content&quot;
                hx-push-url=&quot;true&quot;
                _=&quot;on click remove .active from .tab-button then add .active to me&quot;&gt;
            Tab 2
        &lt;/button&gt;
    &lt;/div&gt;
    
    &lt;div id=&quot;tab-content&quot;&gt;
        &lt;p&gt;Default content loads here...&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>The Hyperscript on each button handles the active state: first it removes the <code v-pre>.active</code> class from all tab buttons, then adds it to the clicked button. This sequence ensures only one tab appears active at a time.</p>
<p>When the user clicks Tab 2, views its content, navigates to another page, and then hits back, htmx restores the entire <code v-pre>#dashboard-content</code> element including the active tab state and the tab content. The experience feels continuous rather than reset.</p>
<p>You can also preserve form input values by placing the form inside your history element:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div id=&quot;search-section&quot; hx-history-elt&gt;
    &lt;form hx-get=&quot;/Products?handler=Filter&quot;
          hx-target=&quot;#product-list&quot;
          hx-push-url=&quot;true&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;query&quot; placeholder=&quot;Search...&quot; value=&quot;@Model.Query&quot; /&gt;
        &lt;label&gt;
            &lt;input type=&quot;checkbox&quot; name=&quot;category&quot; value=&quot;books&quot; checked=&quot;@Model.HasBooks&quot; /&gt;
            Books
        &lt;/label&gt;
        &lt;label&gt;
            &lt;input type=&quot;checkbox&quot; name=&quot;category&quot; value=&quot;electronics&quot; checked=&quot;@Model.HasElectronics&quot; /&gt;
            Electronics
        &lt;/label&gt;
        &lt;button type=&quot;submit&quot;&gt;Apply&lt;/button&gt;
    &lt;/form&gt;
    
    &lt;div id=&quot;product-list&quot;&gt;
        &lt;!-- Filtered results appear here --&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>When users apply filters, navigate to a product, and return, their filter selections and search text remain intact. This small detail eliminates the frustration of re-entering search criteria.</p>
<doc-anchor-target id="speed-in-the-stack-supercharging-ux-with-history-based-caching">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#speed-in-the-stack-supercharging-ux-with-history-based-caching">#</doc-anchor-trigger>
        <span>Speed in the Stack: Supercharging UX with History-Based Caching</span>
    </h2>
</doc-anchor-target>
<p>Performance extends beyond server response time to include how quickly your app responds to user actions. History caching gives you a performance boost without touching backend code. Instead of reloading content when a user navigates back, htmx serves the previous state from memory. The page appears instantly.</p>
<p>When users browse paginated content like search results or data tables, each page typically requires an <code v-pre>hx-get</code> request. Without caching, clicking into an item and returning to the list means another server request to reload the same data. With htmx history caching, the previous list view comes from the browser&#x27;s cache instead. Users perceive a dramatic speed improvement.</p>
<p>Combine <code v-pre>hx-push-url</code> with <code v-pre>hx-select</code> to control exactly which parts of the response get stored:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div id=&quot;product-results&quot;
     hx-get=&quot;/Products?handler=Page&quot;
     hx-target=&quot;#product-results&quot;
     hx-push-url=&quot;true&quot;
     hx-select=&quot;#page-content&quot;
     hx-trigger=&quot;load&quot;&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>The <code v-pre>hx-trigger=&quot;load&quot;</code> ensures the request fires when the element enters the DOM. The <code v-pre>hx-select=&quot;#page-content&quot;</code> tells htmx to extract only the <code v-pre>#page-content</code> portion from the server response. This scoped approach prevents caching headers, footers, or other page elements that should remain dynamic.</p>
<p>Your server handler returns a complete response, but htmx extracts only what you specified:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;!-- Server response includes the full structure --&gt;
&lt;div id=&quot;page-content&quot;&gt;
    &lt;table&gt;
        @foreach (var item in Model.Products)
        {
            &lt;tr&gt;
                &lt;td&gt;
                    &lt;a href=&quot;/Products/Details?id=@item.Id&quot;
                       hx-get=&quot;/Products/Details?id=@item.Id&quot;
                       hx-target=&quot;#product-results&quot;
                       hx-push-url=&quot;true&quot;&gt;
                        @item.Name
                    &lt;/a&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        }
    &lt;/table&gt;
    &lt;div class=&quot;pagination&quot;&gt;
        &lt;a href=&quot;/Products?handler=Page&amp;amp;page=1&quot;
           hx-get=&quot;/Products?handler=Page&amp;amp;page=1&quot;
           hx-target=&quot;#product-results&quot;
           hx-push-url=&quot;true&quot;&gt;1&lt;/a&gt;
        &lt;a href=&quot;/Products?handler=Page&amp;amp;page=2&quot;
           hx-get=&quot;/Products?handler=Page&amp;amp;page=2&quot;
           hx-target=&quot;#product-results&quot;
           hx-push-url=&quot;true&quot;&gt;2&lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>When users navigate through pages, each view gets cached. Hitting the back button cycles through those cached pages without server requests. The pagination feels as responsive as flipping through local content.</p>
<p>Test your caching behavior using browser developer tools. Open the Application tab and inspect localStorage to see what htmx has cached. You can also add <code v-pre>htmx.logAll()</code> to your JavaScript console to watch htmx events in real time, including history save and restore operations.</p>
<doc-anchor-target id="designing-for-memory-best-practices-with-history-and-performance">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#designing-for-memory-best-practices-with-history-and-performance">#</doc-anchor-trigger>
        <span>Designing for Memory: Best Practices with History and Performance</span>
    </h2>
</doc-anchor-target>
<p>History caching makes your app feel faster, but it requires thoughtful implementation. Cache the wrong content and users see stale data. Cache too much and you waste browser storage. Here are patterns that work well in production.</p>
<doc-anchor-target id="isolate-dynamic-content">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#isolate-dynamic-content">#</doc-anchor-trigger>
        <span>Isolate Dynamic Content</span>
    </h3>
</doc-anchor-target>
<p>Real-time elements like notification counts, shopping cart totals, or live status indicators should not live inside cached regions. Structure your layout to keep these elements outside the <code v-pre>hx-history-elt</code> container:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;header&gt;
    &lt;div id=&quot;cart-count&quot; hx-get=&quot;/Cart?handler=Count&quot; hx-trigger=&quot;load&quot;&gt;
        &lt;!-- Always fresh --&gt;
    &lt;/div&gt;
&lt;/header&gt;

&lt;main id=&quot;page-content&quot; hx-history-elt&gt;
    &lt;!-- Cached content lives here --&gt;
&lt;/main&gt;</code></pre>
</doc-codeblock></div>
<p>The cart count loads fresh on every page view while the main content benefits from caching.</p>
<doc-anchor-target id="use-hx-select-to-scope-cached-responses">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#use-hx-select-to-scope-cached-responses">#</doc-anchor-trigger>
        <span>Use hx-select to Scope Cached Responses</span>
    </h3>
</doc-anchor-target>
<p>When your server returns a full page but you only want to cache part of it, use <code v-pre>hx-select</code>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div id=&quot;product-container&quot;
     hx-get=&quot;/Products?handler=Page&quot;
     hx-target=&quot;#product-list&quot;
     hx-select=&quot;#product-list&quot;
     hx-push-url=&quot;true&quot;
     hx-trigger=&quot;revealed&quot;&gt;
&lt;/div&gt;

&lt;div id=&quot;product-list&quot;&gt;
    &lt;!-- Products load here --&gt;
&lt;/div&gt;

&lt;div id=&quot;cart-summary&quot;&gt;
    &lt;!-- Never cached because it is outside the selected element --&gt;
    &lt;partial name=&quot;_CartSummary&quot; /&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>The server returns both the product list and cart summary, but only <code v-pre>#product-list</code> gets extracted and cached.</p>
<doc-anchor-target id="build-consistent-partials">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#build-consistent-partials">#</doc-anchor-trigger>
        <span>Build Consistent Partials</span>
    </h3>
</doc-anchor-target>
<p>Razor Partials should return stable HTML structures regardless of request context. Avoid conditional wrappers that change the DOM structure:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;!-- Good: Consistent structure --&gt;
&lt;div id=&quot;results-wrapper&quot;&gt;
    @if (Model.Products.Any())
    {
        &lt;ul class=&quot;product-list&quot;&gt;
            @foreach (var product in Model.Products)
            {
                &lt;li&gt;@product.Name&lt;/li&gt;
            }
        &lt;/ul&gt;
    }
    else
    {
        &lt;p class=&quot;no-results&quot;&gt;No products found.&lt;/p&gt;
    }
&lt;/div&gt;

&lt;!-- Avoid: Inconsistent wrapper elements --&gt;
@if (Model.Products.Any())
{
    &lt;ul&gt;...&lt;/ul&gt;
}
else
{
    &lt;div&gt;No products&lt;/div&gt;
}</code></pre>
</doc-codeblock></div>
<p>Consistent structures ensure htmx can reliably cache and restore content without layout shifts or broken references.</p>
<doc-anchor-target id="manage-focus-for-accessibility">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#manage-focus-for-accessibility">#</doc-anchor-trigger>
        <span>Manage Focus for Accessibility</span>
    </h3>
</doc-anchor-target>
<p>When content restores from cache, users navigating via keyboard or screen reader need proper focus management. Use Hyperscript to restore focus after history restoration:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div id=&quot;search-results&quot; hx-history-elt _=&quot;on htmx:historyRestore focus() on #search-input&quot;&gt;
    &lt;input type=&quot;text&quot; id=&quot;search-input&quot; name=&quot;query&quot; /&gt;
    &lt;!-- Results appear here --&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>The <code v-pre>htmx:historyRestore</code> event fires after htmx restores cached content. The Hyperscript moves focus to the search input, orienting the user within the restored interface.</p>
<p>For screen reader users, include <code v-pre>aria-live</code> regions to announce dynamic updates:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div id=&quot;results-status&quot; aria-live=&quot;polite&quot; class=&quot;visually-hidden&quot;&gt;
    @Model.Products.Count() products found
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="handle-forms-carefully">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#handle-forms-carefully">#</doc-anchor-trigger>
        <span>Handle Forms Carefully</span>
    </h3>
</doc-anchor-target>
<p>Forms inside cached regions retain their values when restored, which is usually what users want. CSRF tokens and other security-sensitive hidden fields can become stale though. Consider refreshing these on restoration:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;form id=&quot;product-form&quot; hx-post=&quot;/Products?handler=Create&quot; hx-target=&quot;#result&quot;&gt;
    @Html.AntiForgeryToken()
    &lt;input type=&quot;text&quot; name=&quot;name&quot; /&gt;
    &lt;button type=&quot;submit&quot;&gt;Create&lt;/button&gt;
&lt;/form&gt;

&lt;script&gt;
document.body.addEventListener('htmx:historyRestore', function() {
    // Refresh anti-forgery token after history restore
    htmx.ajax('GET', '/Products?handler=Token', {target: '#product-form input[name=&quot;__RequestVerificationToken&quot;]', swap: 'outerHTML'});
});
&lt;/script&gt;</code></pre>
</doc-codeblock></div>
<p>This pattern ensures security tokens stay valid even when forms are restored from cache.</p>
<doc-anchor-target id="test-navigation-thoroughly">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#test-navigation-thoroughly">#</doc-anchor-trigger>
        <span>Test Navigation Thoroughly</span>
    </h3>
</doc-anchor-target>
<p>History-related bugs are subtle and vary by browser. Build a testing checklist:</p>
<ol>
<li>Navigate forward through several pages</li>
<li>Use the back button to return through each page</li>
<li>Use the forward button to advance again</li>
<li>Verify scroll positions, form values, and active states at each step</li>
<li>Test with browser developer tools open to watch for console errors</li>
<li>Test on multiple browsers since history handling can differ</li>
</ol>
<p>Use htmx debugging to trace history operations:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-javascript"><code v-pre class="language-javascript">htmx.logger = function(elt, event, data) {
    if (event.indexOf('history') &gt; -1) {
        console.log(event, data);
    }
};</code></pre>
</doc-codeblock></div>
<p>This logs only history-related events, making it easier to trace caching behavior.</p>
<doc-anchor-target id="common-pitfalls-and-solutions">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#common-pitfalls-and-solutions">#</doc-anchor-trigger>
        <span>Common Pitfalls and Solutions</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="stale-data-after-server-changes">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#stale-data-after-server-changes">#</doc-anchor-trigger>
        <span>Stale Data After Server Changes</span>
    </h3>
</doc-anchor-target>
<p>If server data changes while a user has cached content, they might see outdated information when navigating back. For critical data, consider adding a freshness check:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;div hx-get=&quot;/Products?handler=Page&quot;
     hx-target=&quot;#product-list&quot;
     hx-push-url=&quot;true&quot;
     hx-trigger=&quot;load, htmx:historyRestore from:body&quot;&gt;
&lt;/div&gt;</code></pre>
</doc-codeblock></div>
<p>The <code v-pre>htmx:historyRestore from:body</code> trigger causes a fresh request whenever content is restored from history, ensuring users always see current data. Use this selectively since it negates the performance benefits of caching.</p>
<doc-anchor-target id="cache-size-limits">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cache-size-limits">#</doc-anchor-trigger>
        <span>Cache Size Limits</span>
    </h3>
</doc-anchor-target>
<p>Browsers limit localStorage to around 5-10MB. If your pages are large or users navigate extensively, you might hit this limit. Monitor cache size and adjust <code v-pre>historyCacheSize</code> accordingly:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-javascript"><code v-pre class="language-javascript">htmx.config.historyCacheSize = 5; // Reduce for large page content</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="url-mismatch-issues">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#url-mismatch-issues">#</doc-anchor-trigger>
        <span>URL Mismatch Issues</span>
    </h3>
</doc-anchor-target>
<p>Ensure your <code v-pre>hx-get</code> URLs match the pattern you want in the browser address bar. Inconsistent URLs can cause confusion when users bookmark or share links:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-markup"><code v-pre class="language-markup">&lt;!-- Consistent URL pattern --&gt;
&lt;a hx-get=&quot;/Products?handler=Details&amp;amp;id=@product.Id&quot;
   hx-push-url=&quot;/Products/Details/@product.Id&quot;
   hx-target=&quot;#main-content&quot;&gt;
    @product.Name
&lt;/a&gt;</code></pre>
</doc-codeblock></div>
<p>The <code v-pre>hx-push-url</code> can specify a different URL than <code v-pre>hx-get</code>, letting you maintain clean user-facing URLs while using Razor Pages handler routing internally.</p>
<doc-anchor-target id="summary">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#summary">#</doc-anchor-trigger>
        <span>Summary</span>
    </h2>
</doc-anchor-target>
<p>History caching transforms how users experience navigation in your Razor Pages application. Instead of reloading pages, htmx restores cached content instantly. Instead of losing form inputs and scroll positions, users return to exactly where they left off.</p>
<p>The key concepts to remember:</p>
<ul>
<li><code v-pre>hx-push-url=&quot;true&quot;</code> enables history caching automatically</li>
<li><code v-pre>hx-history=&quot;false&quot;</code> disables caching for sensitive content</li>
<li><code v-pre>hx-history-elt</code> specifies which element to snapshot</li>
<li><code v-pre>hx-select</code> scopes which parts of the response get cached</li>
<li>Consistent HTML structures make caching reliable</li>
<li>Focus management maintains accessibility</li>
<li>Testing across browsers catches subtle issues</li>
</ul>
<p>In the next chapter, we will explore <code v-pre>hx-disable</code> and <code v-pre>hx-request</code> for fine-grained control over when and how htmx makes requests. These tools complement history caching by letting you optimize request behavior and manage loading states.</p>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer id="retype-content-footer" class="clear-both">
                                <div class="flex flex-wrap items-center justify-between mt-14">
                                    <a id="retype-edit-this-page" class="my-2.5 inline-flex items-center text-sm whitespace-nowrap text-body-link font-body-link-weight hover:text-body-link-hover hover:underline" href="https://github.com/cwoodruff/book-aspnet-htmx/blob/main/Chapter18/chapter18.md" target="_blank" rel="noopener">
                                        <svg class="mr-1.5" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M20 12c-.55 0-1 .45-1 1v7c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h7c.55 0 1-.45 1-1s-.45-1-1-1H4C2.35 3 1 4.35 1 6v14c0 1.65 1.35 3 3 3h14c1.65 0 3-1.35 3-3v-7c0-.55-.45-1-1-1z" /><path d="M22.21 1.79c-1.18-1.18-3.24-1.18-4.41 0l-9.5 9.5c-.13.13-.22.29-.26.46l-1 4c-.08.34.01.7.26.95.18.2.44.3.7.3.08 0 .16-.01.24-.03l4-1c.18-.04.34-.13.46-.26l9.5-9.5c1.22-1.22 1.22-3.2.01-4.42zm-1.42 3l-9.3 9.3-2.11.53.53-2.11 9.3-9.3c.42-.42 1.16-.42 1.59 0 .43.43.43 1.15-.01 1.58z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        <span>Edit this page</span>
                                    </a>
                                </div>
                            
                                <nav id="retype-nextprev" class="print:hidden flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../chapter17/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-base-text-muted">Previous</span>
                                                <span class="block mt-1">Chap 17 - Form Enhancements with hx-params, hx-vals, and hx-validate</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../chapter19/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-base-text-muted">Next</span>
                                                <span class="block mt-1">Chap 19 - Optimizing Requests with hx-disabled-elt, hx-request, and hx-sync</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div id="retype-page-footer" class="print:border-none border-t border-base-border pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between print:justify-center">
                                <div id="retype-footer-links" class="print:hidden">
                                    <ul class="flex flex-wrap items-center text-sm">
                                        <li>
                                            <a class="inline-flex items-center mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-footer-link hover:text-footer-link-hover md:mb-0" href="../copyright/">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                    <g fill="currentColor">
                                                        <path d="M10.97 8.265a1.45 1.45 0 0 0-.487.57.75.75 0 0 1-1.341-.67c.2-.402.513-.826.997-1.148C10.627 6.69 11.244 6.5 12 6.5c.658 0 1.369.195 1.934.619a2.45 2.45 0 0 1 1.004 2.006c0 1.033-.513 1.72-1.027 2.215-.19.183-.399.358-.579.508l-.147.123a4.329 4.329 0 0 0-.435.409v1.37a.75.75 0 1 1-1.5 0v-1.473c0-.237.067-.504.247-.736.22-.28.486-.517.718-.714l.183-.153.001-.001c.172-.143.324-.27.47-.412.368-.355.569-.676.569-1.136a.953.953 0 0 0-.404-.806C12.766 8.118 12.384 8 12 8c-.494 0-.814.121-1.03.265ZM13 17a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1ZM2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12Z"/>
                                                    </g>
                                                </svg>
                                                <span>Copyright</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="inline-flex items-center mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-footer-link hover:text-footer-link-hover md:mb-0" href="../license/">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                    <g fill="currentColor">
                                                        <path d="M16.53 9.78a.75.75 0 0 0-1.06-1.06L11 13.19l-1.97-1.97a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l5-5Z"/><path d="m12.54.637 8.25 2.675A1.75 1.75 0 0 1 22 4.976V10c0 6.19-3.771 10.704-9.401 12.83a1.704 1.704 0 0 1-1.198 0C5.77 20.705 2 16.19 2 10V4.976c0-.758.489-1.43 1.21-1.664L11.46.637a1.748 1.748 0 0 1 1.08 0Zm-.617 1.426-8.25 2.676a.249.249 0 0 0-.173.237V10c0 5.46 3.28 9.483 8.43 11.426a.199.199 0 0 0 .14 0C17.22 19.483 20.5 15.461 20.5 10V4.976a.25.25 0 0 0-.173-.237l-8.25-2.676a.253.253 0 0 0-.154 0Z"/>
                                                    </g>
                                                </svg>
                                                <span>License</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div id="retype-copyright" class="print:justify-center py-2 text-footer-text font-footer-link-weight text-sm leading-relaxed"><p> Copyright 2026. All rights reserved Chris Woodruff.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-sidebar-right-bg border-sidebar-right-border lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="retype-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Chap 18 - Caching and History with hx-history and hx-history-elt", level: 1, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
